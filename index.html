<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>College Basketball Scores</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }

    header {
        background-color: #333;
        color: #fff;
        padding: 20px;
        text-align: center;
    }

    main {
        padding: 20px;
    }

    #update-message {
        margin-bottom: 10px;
        font-style: italic;
    }

    #game-list {
        list-style-type: none;
        padding: 0;
    }

    #game-list li {
        margin-bottom: 10px;
        border: 1px solid #ccc;
        padding: 10px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    #game-list li span {
        flex: 1;
        text-align: center;
    }

    #refresh-info {
        margin-top: 20px;
        text-align: center;
    }

    #refresh-info span {
        font-style: italic;
    }

    #refresh-button {
        background-color: #4CAF50;
        border: none;
        color: white;
        padding: 15px 32px;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 16px;
        margin: 4px 2px;
        cursor: pointer;
        border-radius: 8px;
    }
</style>
</head>
<body>
<header>
    <h1>College Basketball Scores</h1>
</header>
<main>
    <div id="update-message">Scores are updating...</div>
    <ul id="game-list"></ul>
    <div id="refresh-info">Last refreshed: <span id="last-refresh"></span></div>
    <button id="refresh-button" onclick="fetchScores()">
        Refresh
    </button>
</main>
<script>
    // Function to fetch data from the API and update the game list
    function fetchScores() {
        const updateMessage = document.getElementById('update-message');
        updateMessage.textContent = 'Scores are updating...';

        const url = 'https://api.sportsdata.io/v3/cbb/scores/json/GamesByDate/2024-03-20?key=d9390cfaf8aa49dc84c1981109dbe3cd';

        // Fetch data from the API
        fetch(url)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                updateGameList(data);
                updateMessage.textContent = ''; // Clear update message
                updateLastRefresh(); // Update last refresh time
            })
            .catch(error => {
                console.error('There was a problem with the fetch operation:', error);
                updateMessage.textContent = 'Failed to update scores';
            });
    }

    // Function to update the game list with fetched data
    function updateGameList(games) {
        const gameList = document.getElementById('game-list');
        gameList.innerHTML = '';

        games.forEach(game => {
            if (game.HomeTeam !== null && game.AwayTeam !== null && game.HomeTeamScore !== null && game.AwayTeamScore !== null) {
                const timeLeft = game.Status === 'Final' ? 'FINAL' : game.TimeRemainingMinutes !== null ? `Time Left: ${game.TimeRemainingMinutes} mins` : '';
                if (timeLeft !== 'FINAL') {
                    const listItem = document.createElement('li');
                    const winner = game.HomeTeamScore > game.AwayTeamScore ? game.HomeTeam : game.AwayTeam;
                    const loser = game.HomeTeamScore < game.AwayTeamScore ? game.HomeTeam : game.AwayTeam;
                    listItem.innerHTML = `
                        <span>${game.AwayTeam} ${game.AwayTeamScore}</span>
                        <span>vs</span>
                        <span>${game.HomeTeam} ${game.HomeTeamScore}</span>
                        <span>${timeLeft}</span>
                        <span>Winner: ${winner.charAt(winner.length - 1)} Loser: ${loser.charAt(loser.length - 1)}</span>
                    `;
                    gameList.appendChild(listItem);
                }
            }
        });
    }

    // Function to update the last refresh time
    function updateLastRefresh() {
        const lastRefresh = document.getElementById('last-refresh');
        const now = new Date();
        const formattedTime = now.toLocaleTimeString();
        lastRefresh.textContent = formattedTime;
    }

    // Fetch scores initially and then every 5 seconds
    fetchScores();
    setInterval(fetchScores, 5000);
</script>
</body>
</html>
